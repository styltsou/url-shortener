openapi: 3.1.0
info:
  title: URL Shortener API
  version: 1.0.0
  description: API for creating and managing shortened URLs with authentication via Clerk
servers:
- url: http://localhost:8080
  description: Local development server
tags:
- name: Links
  description: Operations for managing shortened links
- name: Tags
  description: Operations for managing tags
- name: Public
  description: Public endpoints that don't require authentication
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: 'Clerk authentication token. Include the token in the Authorization header as: Bearer <token>'
  schemas:
    Tag:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the tag
        name:
          type: string
          maxLength: 30
          description: Tag name
        created_at:
          type: string
          format: date-time
          description: Timestamp when the tag was created
        updated_at:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when the tag was last updated
      required:
      - id
      - name
      - created_at
    Link:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Unique identifier for the link
        shortcode:
          type: string
          maxLength: 20
          description: Short code used in the shortened URL
        original_url:
          type: string
          format: uri
          description: The original long URL that was shortened
        expires_at:
          type: string
          format: date-time
          nullable: true
          description: Optional expiration date for the link
        is_active:
          type: boolean
          description: Whether the link is active (can be disabled without deleting)
        created_at:
          type: string
          format: date-time
          description: Timestamp when the link was created
        updated_at:
          type: string
          format: date-time
          nullable: true
          description: Timestamp when the link was last updated
        tags:
          type: array
          items:
            $ref: '#/components/schemas/Tag'
          description: Tags associated with this link
      required:
      - id
      - shortcode
      - original_url
      - is_active
      - created_at
      - tags
    CreateLinkRequest:
      type: object
      required:
      - url
      properties:
        url:
          type: string
          format: uri
          description: The URL to shorten
    UpdateLinkRequest:
      type: object
      properties:
        shortcode:
          type: string
          maxLength: 20
          description: New shortcode for the link (optional)
        is_active:
          type: boolean
          description: Whether the link is active (optional)
        expires_at:
          type: string
          format: date-time
          nullable: true
          description: New expiration date for the link (optional, set to null to remove expiration)
    CreateTagRequest:
      type: object
      required:
      - name
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 30
          description: Tag name (whitespace will be trimmed)
    UpdateTagRequest:
      type: object
      required:
      - name
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 30
          description: Tag name (whitespace will be trimmed)
    DeleteTagsRequest:
      type: object
      required:
      - tag_ids
      properties:
        tag_ids:
          type: array
          items:
            type: string
            format: uuid
          minItems: 1
          description: Array of tag IDs to delete
    AddTagsToLinkRequest:
      type: object
      required:
      - tag_ids
      properties:
        tag_ids:
          type: array
          items:
            type: string
            format: uuid
          minItems: 1
          description: Array of tag IDs to add to the link
    RemoveTagsFromLinkRequest:
      type: object
      required:
      - tag_ids
      properties:
        tag_ids:
          type: array
          items:
            type: string
            format: uuid
          minItems: 1
          description: Array of tag IDs to remove from the link
    SuccessResponse:
      type: object
      properties:
        data:
          description: Response data (type varies by endpoint)
      required:
      - data
    LinkSuccessResponse:
      type: object
      properties:
        data:
          $ref: '#/components/schemas/Link'
      required:
      - data
    LinksListSuccessResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Link'
      required:
      - data
    PaginationMeta:
      type: object
      properties:
        page:
          type: integer
          minimum: 1
          description: Current page number
          example: 1
        limit:
          type: integer
          minimum: 1
          maximum: 100
          description: Number of items per page
          example: 20
        total:
          type: integer
          minimum: 0
          description: Total number of items
          example: 45
        total_pages:
          type: integer
          minimum: 0
          description: Total number of pages
          example: 3
      required:
      - page
      - limit
      - total
      - total_pages
    PaginatedLinksResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Link'
          description: Array of links for the current page
        pagination:
          $ref: '#/components/schemas/PaginationMeta'
      required:
      - data
      - pagination
    TagSuccessResponse:
      type: object
      properties:
        data:
          $ref: '#/components/schemas/Tag'
      required:
      - data
    TagsListSuccessResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Tag'
      required:
      - data
    TagsBulkDeleteSuccessResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Tag'
          description: Array of deleted tags
      required:
      - data
    ErrorResponse:
      type: object
      properties:
        error:
          $ref: '#/components/schemas/ErrorDetail'
      required:
      - error
    ErrorDetail:
      type: object
      properties:
        code:
          type: string
          enum:
          - invalid_request
          - authentication_required
          - authentication_failed
          - invalid_id
          - link_not_found
          - invalid_url
          - link_expired
          - code_taken
          - tag_not_found
          - tag_name_taken
          - internal_server_error
          description: Machine-readable error code
        title:
          type: string
          description: Human-readable error title
        detail:
          type: string
          description: Detailed error message
      required:
      - code
      - title
paths:
  /{code}:
    get:
      tags:
      - Public
      summary: Redirect to original URL
      description: Public endpoint that redirects to the original URL associated with the shortcode. Does not require authentication.
      operationId: redirect
      parameters:
      - name: code
        in: path
        required: true
        schema:
          type: string
          maxLength: 20
        description: The shortcode to redirect
      responses:
        '302':
          description: Redirect to the original URL
          headers:
            Location:
              schema:
                type: string
                format: uri
              description: The original URL to redirect to
        '404':
          description: Link not found, expired, or inactive
          content:
            text/html:
              schema:
                type: string
                description: HTML error page
  /api/v1/health:
    get:
      tags:
      - Public
      summary: Health check
      description: Returns the health status of the API service
      operationId: healthCheck
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  service:
                    type: string
                    example: URL Shortener API
                required:
                - status
                - service
  /api/v1/reference:
    get:
      tags:
      - Public
      summary: API Reference Documentation
      description: Returns the Scalar API reference UI for viewing the OpenAPI specification
      operationId: getApiReference
      responses:
        '200':
          description: HTML page with API reference
          content:
            text/html:
              schema:
                type: string
        '500':
          description: Failed to generate API reference
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/links:
    get:
      tags:
      - Links
      summary: List all links
      description: |
        Retrieves paginated shortened links for the authenticated user, including their tags.
        Supports filtering by tags and status (active/inactive).
      operationId: listLinks
      security:
      - BearerAuth: []
      parameters:
      - name: tags
        in: query
        required: false
        description: Comma-separated list of tag UUIDs to filter by
        schema:
          type: string
          example: "550e8400-e29b-41d4-a716-446655440000,6ba7b810-9dad-11d1-80b4-00c04fd430c8"
      - name: status
        in: query
        required: false
        description: Filter links by status
        schema:
          type: string
          enum:
          - all
          - active
          - inactive
          default: all
          example: active
      - name: page
        in: query
        required: false
        description: Page number (1-indexed)
        schema:
          type: integer
          minimum: 1
          default: 1
          example: 1
      - name: limit
        in: query
        required: false
        description: Number of items per page (max 100)
        schema:
          type: integer
          minimum: 1
          maximum: 100
          default: 5
          example: 5
      responses:
        '200':
          description: Paginated list of user's links
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedLinksResponse'
        '401':
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      tags:
      - Links
      summary: Create a new shortened link
      description: Creates a new shortened link for the authenticated user
      operationId: createLink
      security:
      - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateLinkRequest'
      responses:
        '201':
          description: Link created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LinkSuccessResponse'
        '400':
          description: Bad request - Invalid URL or request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/links/{shortcode}:
    get:
      tags:
      - Links
      summary: Get a link by shortcode
      description: Retrieves a specific shortened link by its shortcode. The link must belong to the authenticated user.
      operationId: getLink
      security:
      - BearerAuth: []
      parameters:
      - name: shortcode
        in: path
        required: true
        schema:
          type: string
          maxLength: 20
        description: The shortcode of the link to retrieve
      responses:
        '200':
          description: Link retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LinkSuccessResponse'
        '401':
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Link not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/links/{id}:
    patch:
      tags:
      - Links
      summary: Update a link
      description: Updates a shortened link. Supports updating shortcode, is_active status, and expiration date. The link must belong to the authenticated user.
      operationId: updateLink
      security:
      - BearerAuth: []
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: The UUID of the link to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateLinkRequest'
      responses:
        '200':
          description: Link updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LinkSuccessResponse'
        '400':
          description: Bad request - Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Link not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflict - Shortcode already taken
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      tags:
      - Links
      summary: Delete a link
      description: Soft deletes a shortened link. The link must belong to the authenticated user.
      operationId: deleteLink
      security:
      - BearerAuth: []
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: The UUID of the link to delete
      responses:
        '200':
          description: Link deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LinkSuccessResponse'
        '400':
          description: Bad request - Invalid ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Link not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/links/{id}/tags:
    post:
      tags:
      - Links
      summary: Add tags to a link
      description: Adds one or more tags to a link. Both the link and all tags must belong to the authenticated user.
      operationId: addTagsToLink
      security:
      - BearerAuth: []
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: The UUID of the link
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddTagsToLinkRequest'
      responses:
        '200':
          description: Tags added successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LinkSuccessResponse'
        '400':
          description: Bad request - Invalid ID format or request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Link or tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/links/{id}/tags/remove:
    post:
      tags:
      - Links
      summary: Remove tags from a link
      description: Removes one or more tags from a link. Both the link and all tags must belong to the authenticated user.
      operationId: removeTagsFromLink
      security:
      - BearerAuth: []
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: The UUID of the link
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RemoveTagsFromLinkRequest'
      responses:
        '200':
          description: Tags removed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LinkSuccessResponse'
        '400':
          description: Bad request - Invalid ID format or request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Link or tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/tags:
    get:
      tags:
      - Tags
      summary: List all tags
      description: Retrieves all tags for the authenticated user
      operationId: listTags
      security:
      - BearerAuth: []
      responses:
        '200':
          description: List of user's tags
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TagsListSuccessResponse'
        '401':
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      tags:
      - Tags
      summary: Create a new tag
      description: Creates a new tag for the authenticated user. Tag names must be unique per user.
      operationId: createTag
      security:
      - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTagRequest'
      responses:
        '201':
          description: Tag created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TagSuccessResponse'
        '400':
          description: Bad request - Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflict - Tag name already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/tags/{id}:
    patch:
      tags:
      - Tags
      summary: Update a tag
      description: Updates a tag name. The tag must belong to the authenticated user. Tag names must be unique per user.
      operationId: updateTag
      security:
      - BearerAuth: []
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: The UUID of the tag to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTagRequest'
      responses:
        '200':
          description: Tag updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TagSuccessResponse'
        '400':
          description: Bad request - Invalid ID format or request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Conflict - Tag name already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      tags:
      - Tags
      summary: Delete a tag
      description: Hard deletes a tag. The tag must belong to the authenticated user. All link-tag relationships will be automatically removed.
      operationId: deleteTag
      security:
      - BearerAuth: []
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
          format: uuid
        description: The UUID of the tag to delete
      responses:
        '200':
          description: Tag deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TagSuccessResponse'
        '400':
          description: Bad request - Invalid ID format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Tag not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /api/v1/tags/bulk-delete:
    post:
      tags:
      - Tags
      summary: Bulk delete tags
      description: Hard deletes multiple tags. All tags must belong to the authenticated user. All link-tag relationships will be automatically removed.
      operationId: bulkDeleteTags
      security:
      - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteTagsRequest'
      responses:
        '200':
          description: Tags deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TagsBulkDeleteSuccessResponse'
        '400':
          description: Bad request - Invalid request body
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized - Missing or invalid authentication token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
